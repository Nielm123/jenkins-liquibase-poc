pipeline {
  agent {
    dockerContainer { image 'laskmat/liquibase:git423' }
  }
  stages {
    stage('env check') {
      steps {
            sh 'env'
      }
    }
    stage('Status') {
      steps {
          withCredentials([usernamePassword(credentialsId: '4f53ec09-6106-4a31-b1bc-b69cf00c4229', passwordVariable: 'password', usernameVariable: 'username')]) {

            sh 'liquibase status --url="jdbc:snowflake://https://qu13708.eu-central-1.snowflakecomputing.com/?user=MATEUSZ_LASKOWSKI&warehouse=POC_WAREHOUSE&db=DBT_VAULT_POC&schema=PUBLIC&role=POC" --changeLogFile=dataset_wrapper.xml --defaultsFile=/liquibase/liquibase.properties --username=$username  --password=$password'
          }
      }
    }
    stage('Do nations modifications') {
      steps {
          withCredentials([usernamePassword(credentialsId: '4f53ec09-6106-4a31-b1bc-b69cf00c4229', passwordVariable: 'password', usernameVariable: 'username')]) {

            sh 'liquibase update --url="jdbc:snowflake://https://qu13708.eu-central-1.snowflakecomputing.com/?user=MATEUSZ_LASKOWSKI&warehouse=POC_WAREHOUSE&db=DBT_VAULT_POC&schema=PUBLIC&role=POC" --changeLogFile=dataset_wrapper.xml --defaultsFile=/liquibase/liquibase.properties --username=$username  --password=$password'
          }
      }      
    }
  }
  post {
    always {
        archiveArtifacts artifacts: '*.xml', followSymlinks: false, onlyIfSuccessful: true
    }
  }  
}
